import{P as B}from"./PaginationComponent-2b1a17c3.js";import{S as U}from"./sweetalert2.all-8c1162e6.js";import{_ as E,r as P,o as c,c as a,a as e,g as n,w as C,p as g,v,F as y,h as L,t as h,i as V,l as f,s as k,I as D,M as A}from"./index-f9ea5c89.js";const{VITE_URL:x,VITE_PATH:I}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},N={props:["tempProduct","isNew","closeModal","getProducts"],data(){return{newProduct:{},loadingItem:"",tempPrice:0}},methods:{updateProduct(){this.loadingItem="confirmButton";let l="post",t=`${x}/v2/api/${I}/admin/product`;this.isNew||(t+=`/${this.tempProduct.id}`,l="put"),this.setPriceHistory(),this.$http[l](t,{data:this.newProduct}).then(()=>{U.fire({icon:"success",title:`${l==="put"?"修改成功":"新增成功"}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.closeModal(),this.getProducts()}})}).catch(d=>{console.log(d)}).finally(()=>{this.loadingItem=""})},setPriceHistory(){let l={},t=new Date().getTime();l[t]=this.newProduct.price,this.isNew?(this.newProduct.history=[],this.newProduct.history.push(l)):this.tempPrice>this.newProduct.price&&this.newProduct.history.push(l)},uploadImage(l){let t=document.querySelector("#formFile");this.loadingItem="images",l==="main"&&(t=document.querySelector("#mainImage"),this.loadingItem="mainImage");const d=new FormData;d.append("file-to-upload",t.files[0]),this.$http.post(`${x}/v2/api/${I}/admin/upload`,d).then(u=>{u.data.imageUrl?l==="main"?this.newProduct.imageUrl=u.data.imageUrl:l==="multi"&&this.newProduct.imagesUrl.push(u.data.imageUrl):alert(u.data.message),t.value="",this.loadingItem=""}).catch(u=>{alert(u)})}},watch:{tempProduct(){this.newProduct={...this.tempProduct},this.tempPrice=this.tempProduct.price}}},R={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},F={class:"modal-content"},q={class:"modal-header bg-light"},H={class:"modal-title",id:"productModalLabel"},O={key:0},j={key:1},z={class:"modal-body"},G={class:"col-4"},W={class:"mb-5"},J=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),K={class:"mb-3"},Q=["disabled"],X=["src"],Y=e("h4",null,"多圖新增",-1),Z={key:0},$={class:"d-flex justify-content-space-between"},ee=["for"],te=["onClick"],oe=["onUpdate:modelValue","id"],se=["src"],le={key:0},ie=e("p",{class:"text-center"},"或",-1),ne={class:"mb-3"},de=["disabled"],ce={class:"col-8"},ae={class:"row gy-3"},re={class:"col-12"},ue=e("label",{for:"productTitle",class:"form-label"},"商品名稱:",-1),me={class:"col-6"},pe=e("label",{for:"productCategory",class:"form-label"},"分類:",-1),_e=e("option",{selected:"",value:"策略"},"策略",-1),he=e("option",{value:"家庭"},"家庭",-1),ge=e("option",{value:"派對"},"派對",-1),fe=e("option",{value:"陣營"},"陣營",-1),be=e("option",{value:"雙人"},"雙人",-1),Pe=e("option",{value:"合作"},"合作",-1),ve=e("option",{value:"劇情"},"劇情",-1),we={class:"col-3"},ye=e("label",{for:"productUnit",class:"form-label"},"單位:",-1),Ue={class:"col-3"},Ve=e("label",{for:"productStock",class:"form-label"},"數量:",-1),Me={class:"col-6"},Ce=e("label",{for:"productOriginPrice",class:"form-label"},"原價:",-1),ke={class:"col-6"},xe=e("label",{for:"productPrice",class:"form-label"},"售價:",-1),Ie={class:"col-4"},Te=e("label",{for:"productLanguage",class:"form-label"},"語言",-1),Se=e("option",{selected:"",value:"繁中"},"繁中",-1),Ee=e("option",{value:"簡中"},"簡中",-1),Le=e("option",{value:"英文"},"英文",-1),Be=[Se,Ee,Le],De={class:"col-4"},Ae=e("label",{for:"productCondition",class:"form-label"},"盒況",-1),Ne=e("option",{selected:"",value:"盒損"},"盒損",-1),Re=e("option",{value:"件損"},"件損",-1),Fe=e("option",{value:"完好"},"完好",-1),qe=e("option",{value:"其他"},"其他",-1),He=[Ne,Re,Fe,qe],Oe=e("hr",null,null,-1),je={class:"col-12"},ze=e("label",{for:"productDescription",class:"form-label"},"描述:",-1),Ge={class:"col-12"},We=e("label",{for:"productContent",class:"form-label"},"內容:",-1),Je=e("label",{for:"is_enabled",class:"form-label"},"是否啟用",-1),Ke={class:"modal-footer"},Qe=["disabled"];function Xe(l,t,d,u,o,m){const p=P("VField"),_=P("ErrorMessage"),i=P("VForm");return c(),a("div",R,[e("div",F,[e("div",q,[e("h5",H,[d.isNew?(c(),a("span",O,"新增產品")):(c(),a("span",j,"編輯產品"))]),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=r=>d.closeModal()),"aria-label":"Close"})]),e("div",z,[n(i,{onSubmit:m.updateProduct,class:"row",ref:"ProductModal",id:"ProductModal"},{default:C(({errors:r})=>[e("div",G,[e("div",W,[J,g(e("input",{type:"text",placeholder:"請輸入圖片連結",id:"imageUrl",class:"form-control mb-2","onUpdate:modelValue":t[1]||(t[1]=s=>o.newProduct.imageUrl=s)},null,512),[[v,o.newProduct.imageUrl]]),e("div",K,[e("input",{class:"form-control",type:"file",id:"mainImage",onChange:t[2]||(t[2]=s=>m.uploadImage("main")),disabled:o.loadingItem==="mainImage"},null,40,Q)]),e("img",{src:o.newProduct.imageUrl,alt:"",class:"img-fluid"},null,8,X)]),e("div",null,[Y,Array.isArray(o.newProduct.imagesUrl)?(c(),a("div",Z,[(c(!0),a(y,null,L(o.newProduct.imagesUrl,(s,b)=>(c(),a(y,{key:b+5566},[e("div",$,[e("label",{for:s,class:"form-label"},"圖片網址"+h(b+1),9,ee),e("button",{type:"button",class:"btn-close btn-sm ms-auto","aria-label":"removeImage",onClick:M=>o.newProduct.imagesUrl.splice(b,1)},null,8,te)]),g(e("input",{type:"text",placeholder:"請輸入圖片連結",class:"form-control mb-1","onUpdate:modelValue":M=>o.newProduct.imagesUrl[b]=M,id:s},null,8,oe),[[v,o.newProduct.imagesUrl[b]]]),e("img",{src:s,alt:"",class:"img-fluid mb-4"},null,8,se)],64))),128)),o.newProduct.imagesUrl[o.newProduct.imagesUrl.length-1]||!o.newProduct.imagesUrl.length?(c(),a("div",le,[e("button",{class:"btn btn-outline-primary w-100 mb-3",type:"button",onClick:t[3]||(t[3]=s=>o.newProduct.imagesUrl.push(""))}," 新增圖片網址 "),ie,e("div",ne,[e("input",{class:"form-control",type:"file",id:"formFile",onChange:t[4]||(t[4]=s=>m.uploadImage("multi")),disabled:o.loadingItem==="images"},null,40,de)])])):V("",!0)])):V("",!0)])]),e("div",ce,[e("div",ae,[e("div",re,[ue,n(p,{id:"productTitle",name:"商品名稱",type:"text",class:f(["form-control",{"is-invalid":r.商品名稱}]),placeholder:"請輸入 商品名稱",rules:"required",modelValue:o.newProduct.title,"onUpdate:modelValue":t[5]||(t[5]=s=>o.newProduct.title=s)},null,8,["class","modelValue"]),n(_,{name:"商品名稱",class:"invalid-feedback"})]),e("div",me,[pe,n(p,{id:"productCategory",name:"分類",class:f(["form-control",{"is-invalid":r.分類}]),placeholder:"請輸入 分類",rules:"required",modelValue:o.newProduct.category,"onUpdate:modelValue":t[6]||(t[6]=s=>o.newProduct.category=s),as:"select"},{default:C(()=>[_e,he,ge,fe,be,Pe,ve]),_:2},1032,["class","modelValue"]),n(_,{name:"分類",class:"invalid-feedback"})]),e("div",we,[ye,n(p,{id:"productUnit",name:"單位",type:"text",class:f(["form-control",{"is-invalid":r.單位}]),placeholder:"請輸入 單位",rules:"required",modelValue:o.newProduct.unit,"onUpdate:modelValue":t[7]||(t[7]=s=>o.newProduct.unit=s)},null,8,["class","modelValue"]),n(_,{name:"單位",class:"invalid-feedback"})]),e("div",Ue,[Ve,n(p,{id:"productStock",name:"數量",type:"number",class:f(["form-control",{"is-invalid":r.數量}]),placeholder:"請輸入 數量",rules:"required",modelValue:o.newProduct.stock,"onUpdate:modelValue":t[8]||(t[8]=s=>o.newProduct.stock=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(_,{name:"數量",class:"invalid-feedback"})]),e("div",Me,[Ce,n(p,{id:"productOriginPrice",name:"原價",type:"number",class:f(["form-control",{"is-invalid":r.原價}]),placeholder:"請輸入 原價",rules:{min_value:0,required:!0},modelValue:o.newProduct.origin_price,"onUpdate:modelValue":t[9]||(t[9]=s=>o.newProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(_,{name:"原價",class:"invalid-feedback"})]),e("div",ke,[xe,n(p,{id:"productPrice",name:"售價",type:"number",class:f(["form-control",{"is-invalid":r.售價}]),placeholder:"請輸入 售價",rules:{min_value:0,required:!0},modelValue:o.newProduct.price,"onUpdate:modelValue":t[10]||(t[10]=s=>o.newProduct.price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(_,{name:"售價",class:"invalid-feedback"})]),e("div",Ie,[Te,g(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[11]||(t[11]=s=>o.newProduct.language=s),id:"productLanguage"},Be,512),[[k,o.newProduct.language]])]),e("div",De,[Ae,g(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[12]||(t[12]=s=>o.newProduct.condition=s),id:"productCondition"},He,512),[[k,o.newProduct.condition]])]),Oe,e("div",je,[ze,g(e("textarea",{id:"productDescription",rows:"3",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=s=>o.newProduct.description=s)},null,512),[[v,o.newProduct.description]])]),e("div",Ge,[We,g(e("textarea",{id:"productContent",rows:"3",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=s=>o.newProduct.content=s)},null,512),[[v,o.newProduct.content]])]),e("div",null,[g(e("input",{type:"checkbox",id:"is_enabled",class:"form-check-input","onUpdate:modelValue":t[15]||(t[15]=s=>o.newProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[D,o.newProduct.is_enabled]]),Je])])])]),_:1},8,["onSubmit"])]),e("div",Ke,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[16]||(t[16]=(...r)=>d.closeModal&&d.closeModal(...r))}," 取消 "),e("button",{type:"submit",class:"btn btn-primary",disabled:o.loadingItem==="confirmButton",form:"ProductModal"}," 確認 ",8,Qe)])])])}const Ye=E(N,[["render",Xe]]);const{VITE_URL:T,VITE_PATH:S}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let w={};const Ze={data(){return{products:[],tempProduct:{imagesUrl:[],imageUrl:""},isNew:!0,page:{},isLoading:!1}},components:{PaginationComponent:B,ProductModal:Ye},methods:{getProducts(l=1){this.isLoading=!0,this.$http.get(`${T}/v2/api/${S}/admin/products?page=${l}`).then(t=>{this.products=t.data.products,this.page=t.data.pagination}).catch(t=>{console.log(t)}).finally(()=>{this.isLoading=!1})},openModal(l,t){l==="new"?(this.isNew=!0,this.tempProduct={imageUrl:"",imagesUrl:[]},w.show()):l==="edit"&&(this.isNew=!1,this.tempProduct={...t},w.show()),this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])},closeModal(){this.tempProduct={imagesUrl:[]},w.hide()},deleteProduct(l,t){U.fire({title:`確定刪除${l}嗎?`,text:"刪除後不可復原，確定嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonColor:"#d33",cancelButtonText:"取消"}).then(d=>{d.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${T}/v2/api/${S}/admin/product/${t}`).then(()=>{this.isLoading=!1,U.fire({icon:"success",title:`${l}刪除成功`,showConfirmButton:!1,timer:1e3,didClose:()=>{this.getProducts()}})}).catch(u=>{console.log(u)}))})}},mounted(){var t;const l=(t=document.cookie.split("; ").find(d=>d.startsWith("myToken=")))==null?void 0:t.split("=")[1];this.$http.defaults.headers.common.Authorization=l,this.getProducts(),w=new A("#productModal")}},$e={class:"row justify-content-center"},et={class:"col"},tt={class:"text-end"},ot=e("h2",{class:"h2 text-center"},"產品列表",-1),st={class:"table table-hover align-middle"},lt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"類型"),e("th",{scope:"col"},"語言"),e("th",{scope:"col"},"盒況"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),it=["src"],nt={key:0,class:"text-success"},dt={key:1,class:"text-danger"},ct=["onClick"],at=["onClick"],rt={colspan:"9",class:"text-center"},ut={class:"modal fade",id:"productModal","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"};function mt(l,t,d,u,o,m){const p=P("PaginationComponent"),_=P("ProductModal");return c(),a(y,null,[e("div",$e,[e("div",et,[e("div",tt,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=i=>m.openModal("new"))}," 建立新的產品 ")]),ot,e("table",st,[lt,e("tbody",null,[o.products?(c(!0),a(y,{key:0},L(o.products,i=>(c(),a("tr",{key:i.id},[e("td",null,[e("img",{src:i.imageUrl,alt:"productImage",class:"product-image",onerror:"this.src='../../../public/no_image_icon.png'"},null,8,it)]),e("td",null,h(i.title),1),e("td",null,h(i.category),1),e("td",null,h(i.language),1),e("td",null,h(i.condition),1),e("td",null,h(i.origin_price),1),e("td",null,h(i.price),1),e("td",null,[i.is_enabled?(c(),a("span",nt,"啟用")):(c(),a("span",dt,"未啟用"))]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm me-2",onClick:r=>m.openModal("edit",i)}," 編輯 ",8,ct),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>m.deleteProduct(i.title,i.id)}," 刪除 ",8,at)])]))),128)):V("",!0)]),e("tfoot",null,[e("tr",null,[e("td",rt," 本頁有"+h(o.products.length)+"項產品 ",1)])])]),n(p,{pages:o.page,"get-Method":m.getProducts},null,8,["pages","get-Method"])])]),e("div",ut,[n(_,{"temp-product":o.tempProduct,"is-new":o.isNew,"close-Modal":m.closeModal,"get-Products":m.getProducts},null,8,["temp-product","is-new","close-Modal","get-Products"])])],64)}const gt=E(Ze,[["render",mt]]);export{gt as default};
