import{P as L}from"./PaginationComponent-BULmr1HW.js";import{_ as k,S as p,M,o as i,c as r,a as e,e as c,w as g,n as b,r as _,p as E,d as S,F as v,i as $,k as D,f as N,t as f}from"./index-C-WNfngo.js";var I={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:y,VITE_PATH:V}=I,B={props:{isNew:{type:Boolean},tempCoupon:{type:Object}},data(){return{modalCoupon:{},isLoading:!1,modal:null}},methods:{async updateCoupon(){this.isLoading=!0;const t=this.isNew?"post":"put",o=this.isNew?`${y}/v2/api/${V}/admin/coupon`:`${y}/v2/api/${V}/admin/coupon/${this.modalCoupon.id}`;try{const n=await this.axios[t](o,{data:this.modalCoupon});n.data.success?p.fire({title:`${n.data.message}`,icon:"success",showConfirmButton:!1,timer:1500,didClose:()=>{this.$emit("getCoupons"),this.modal.hide()}}):p.fire({title:"錯誤發生",icon:"error",text:`${n.data.message}`})}catch(n){p.fire({title:"錯誤發生",icon:"error",text:`${n.response.data.message}`})}finally{this.isLoading=!1}},changeDate(t){this.modalCoupon.due_date=t.target.valueAsNumber/1e3,console.log(123)}},watch:{tempCoupon(){this.modalCoupon={...this.tempCoupon},this.modalCoupon.due_date||(this.modalCoupon.due_date=new Date().getTime())}},mounted(){this.modal=new M("#couponModal")}},u=t=>(E("data-v-7fe9df64"),t=t(),S(),t),U={class:"modal fade",id:"couponModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},P={class:"modal-dialog modal-dialog-centered modal-xl"},R={class:"modal-content"},A={class:"modal-header bg-light"},F={class:"modal-title",id:"couponModalLabel"},G={key:0},H={key:1},O=u(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),q={class:"modal-body"},j={class:"row gy-4"},z={class:"col-4"},J=u(()=>e("label",{for:"title",class:"form-label"},"優惠券名稱：",-1)),K={class:"col-4"},Q=u(()=>e("label",{for:"percent",class:"form-label"},"折扣比例：",-1)),W={class:"col-4"},X=u(()=>e("label",{for:"is_enabled",class:"form-label"},"狀態:",-1)),Y=u(()=>e("option",{value:0,selected:"",class:"text-danger"},"未啟用",-1)),Z=u(()=>e("option",{value:1,class:"text-success"},"啟用",-1)),ee={class:"col-4"},oe=u(()=>e("label",{for:"code",class:"form-label"},"折扣碼:",-1)),te={class:"col-4"},se=u(()=>e("label",{for:"due_date",class:"form-label"},"到期日:",-1)),ae=["min","value"],ne={class:"modal-footer"},le=u(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1)),ie=["disabled"],de={key:0},ce={key:1};function re(t,o,n,T,s,d){const m=_("VField"),h=_("ErrorMessage"),C=_("VForm");return i(),r("div",U,[e("div",P,[e("div",R,[e("div",A,[e("h2",F,[n.isNew?(i(),r("span",G,"新增優惠券")):(i(),r("span",H,"編輯優惠券"))]),O]),e("div",q,[c(C,{onSubmit:d.updateCoupon,id:"couponForm"},{default:g(({errors:a})=>[e("div",j,[e("div",z,[J,c(m,{id:"title",name:"優惠券名稱",type:"text",class:b(["form-control",{"is-invalid":a.優惠券名稱}]),placeholder:"請輸入 優惠券名稱",rules:"required",modelValue:s.modalCoupon.title,"onUpdate:modelValue":o[0]||(o[0]=l=>s.modalCoupon.title=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),c(h,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",K,[Q,c(m,{id:"percent",name:"折扣比例",type:"number",class:b(["form-control",{"is-invalid":a.折扣比例}]),placeholder:"請輸入 折扣比例",rules:{min_value:0,max_value:99,required:!0},modelValue:s.modalCoupon.percent,"onUpdate:modelValue":o[1]||(o[1]=l=>s.modalCoupon.percent=l),modelModifiers:{trim:!0,number:!0}},null,8,["class","modelValue"])]),e("div",W,[X,c(m,{id:"is_enabled",name:"狀態",class:b(["form-control",{"is-invalid":a.狀態,"text-success":s.modalCoupon.is_enabled,"text-danger":s.modalCoupon.is_enabled===0}]),placeholder:"請輸入 狀態",rules:"required",modelValue:s.modalCoupon.is_enabled,"onUpdate:modelValue":o[2]||(o[2]=l=>s.modalCoupon.is_enabled=l),as:"select"},{default:g(()=>[Y,Z]),_:2},1032,["class","modelValue"]),c(h,{name:"狀態",class:"invalid-feedback"})]),e("div",ee,[oe,c(m,{id:"code",name:"折扣碼",type:"text",class:b(["form-control",{"is-invalid":a.折扣碼}]),placeholder:"請輸入折扣碼，如:Test123",rules:"required",modelValue:s.modalCoupon.code,"onUpdate:modelValue":o[3]||(o[3]=l=>s.modalCoupon.code=l)},null,8,["class","modelValue"]),c(h,{name:"折扣碼",class:"invalid-feedback"})]),e("div",te,[se,e("input",{type:"date",id:"due_date",name:"到期日",class:"date-input",pattern:"yyyy-MM-dd",min:t.$timeTransform(new Date().getTime()),value:t.$timeTransform(s.modalCoupon.due_date),onInput:o[4]||(o[4]=(...l)=>d.changeDate&&d.changeDate(...l))},null,40,ae)])])]),_:1},8,["onSubmit"])]),e("div",ne,[le,e("button",{type:"submit",class:"btn btn-themeDark",disabled:s.isLoading,form:"couponForm"},[n.isNew?(i(),r("span",de,"新增")):(i(),r("span",ce,"修改"))],8,ie)])])])])}const ue=k(B,[["render",re],["__scopeId","data-v-7fe9df64"]]);var pe={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:x}=pe,me={components:{PaginationComponent:L,CouponModal:ue},data(){return{coupons:[],page:{},isNew:!0,tempCoupon:{},isLoading:!1}},methods:{async getCoupons(t=1){this.isLoading=!0;try{const o=await this.axios.get(`${w}/v2/api/${x}/admin/coupons?page=${t}`);this.coupons=o.data.coupons,this.page=o.data.pagination}catch(o){p.fire({title:"錯誤發生",icon:"error",text:`${o.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}},addNewCoupon(){this.isNew=!0,this.tempCoupon={}},editCoupon(t){this.isNew=!1,this.tempCoupon={...t}},deleteCoupon(t){p.fire({title:`確定要刪除${t.title}嗎`,icon:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定",confirmButtonColor:"hsl(0,85%,70%)"}).then(async o=>{if(o.isConfirmed){this.isLoading=!0;try{const n=await this.axios.delete(`${w}/v2/api/${x}/admin/coupon/${t.id}`);p.fire({title:"刪除成功",icon:"success",text:`${n.data.message}`,showConfirmButton:!1,timer:1e3,didClose:()=>{this.getCoupons()}})}catch(n){p.fire({title:"錯誤發生",icon:"error",text:`${n.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}}})}},mounted(){this.getCoupons()}},_e={class:"py-4"},he=e("h2",{class:"h2 text-center"},"優惠券列表",-1),be={class:"text-end mb-4"},fe={class:"table-responsive"},Ce={class:"table table-hover align-middle"},ge=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"啟用"),e("th",{scope:"col"},"比例"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"折扣碼"),e("th",{scope:"col",width:"120px"},"管理")])],-1),ve={key:0,class:"text-success"},ye={key:1,class:"text-danger"},Ve=["onClick"],we=["onClick"];function xe(t,o,n,T,s,d){const m=_("VLoading"),h=_("PaginationComponent"),C=_("CouponModal");return i(),r(v,null,[c(m,{active:s.isLoading},null,8,["active"]),e("div",_e,[he,e("div",be,[e("button",{type:"button",class:"btn btn-themeDark","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:o[0]||(o[0]=(...a)=>d.addNewCoupon&&d.addNewCoupon(...a))},"建立新優惠券")])]),e("div",fe,[e("table",Ce,[ge,e("tbody",null,[(i(!0),r(v,null,$(s.coupons,a=>(i(),r("tr",{key:a.id},[e("td",null,f(a.title),1),e("td",null,[a.is_enabled?(i(),r("span",ve,"啟用")):(i(),r("span",ye,"關閉"))]),e("td",null,f(a.percent),1),e("td",null,f(t.$timeTransform(a.due_date)),1),e("td",null,f(a.code),1),e("td",null,[e("button",{class:"btn btn-outline-themeDark btn-sm me-2",type:"button","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:l=>d.editCoupon(a)},"編輯",8,Ve),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:l=>d.deleteCoupon(a)},"刪除",8,we)])]))),128))])])]),s.page.total_page>1?(i(),D(h,{key:0,pages:s.page,onGetMethod:d.getCoupons},null,8,["pages","onGetMethod"])):N("",!0),c(C,{"is-new":s.isNew,"temp-coupon":s.tempCoupon,onGetCoupons:d.getCoupons},null,8,["is-new","temp-coupon","onGetCoupons"])],64)}const Le=k(me,[["render",xe]]);export{Le as default};
