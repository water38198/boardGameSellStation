import{P as N}from"./PaginationComponent-BULmr1HW.js";import{_ as S,S as g,M as R,o as n,c,a as o,e as a,w as C,n as b,F as V,i as B,t as h,C as f,H as y,f as k,D as I,b as A,L as F,r as v,p as T,d as E}from"./index-C-WNfngo.js";var q={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:x}=q,O={props:{isNew:{type:Boolean},tempProduct:{type:Object}},data(){return{modalProduct:{},isLoading:!1,imageLoading:!1,modal:null}},methods:{async updateProduct(){this.isLoading=!0;const i=this.isNew?"post":"put",e=this.isNew?`${w}/v2/api/${x}/admin/product`:`${w}/v2/api/${x}/admin/product/${this.tempProduct.id}`;try{const r=await this.axios[i](e,{data:this.modalProduct});g.fire({title:`${r.data.message}`,icon:"success",showConfirmButton:!1,timer:1500,didClose:()=>{this.$emit("getProducts"),this.modal.hide()}})}catch(r){g.fire({title:"錯誤發生",icon:"error",text:`${r.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}},async uploadImage(i){this.imageLoading=!0;let e=null;i==="main"?e=this.$refs.mainImage:e=this.$refs.multiImage;const r=new FormData;r.append("file-to-upload",e.files[0]);try{const p=await this.axios.post(`${w}/v2/api/${x}/admin/upload`,r);p.data.imageUrl?i==="main"?this.modalProduct.imageUrl=p.data.imageUrl:this.modalProduct.imagesUrl.push(p.data.imageUrl):g.fire({title:"錯誤發生",icon:"error",text:`${p.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}catch(p){g.fire({title:"錯誤發生",icon:"error",text:`${p.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{e.value="",this.imageLoading=!1}}},watch:{tempProduct(){this.modalProduct={...this.tempProduct},this.modalProduct.imagesUrl||(this.modalProduct.imagesUrl=[])}},mounted(){this.modal=new R("#productModal")}},l=i=>(T("data-v-5de54c46"),i=i(),E(),i),H={class:"modal fade",id:"productModal","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},z={class:"modal-content"},J={class:"modal-header bg-light"},K={class:"modal-title",id:"productModalLabel"},Q={key:0},W={key:1},X=l(()=>o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),Y={class:"modal-body"},Z={class:"row"},$={class:"col-4"},oo={class:"mb-5"},eo=l(()=>o("label",{for:"productImage",class:"form-label"},"主要圖片:",-1)),to={class:"my-3"},so=["disabled"],lo=["src"],io=l(()=>o("h4",null,"多圖新增",-1)),ao={key:0},no={class:"d-flex justify-content-between"},co=["for"],ro=["onClick"],uo=["onUpdate:modelValue","id"],mo=["src"],_o={key:0},po=l(()=>o("p",{class:"text-center"},"或",-1)),ho={class:"mb-3"},go=["disabled"],bo={class:"col-8"},fo={class:"row gy-3"},vo={class:"col-12"},Po=l(()=>o("label",{for:"productTitle",class:"form-label"},"商品名稱:",-1)),yo={class:"col-6"},Vo=l(()=>o("label",{for:"productCategory",class:"form-label"},"分類:",-1)),Uo=l(()=>o("option",{selected:"",value:"策略"},"策略",-1)),ko=l(()=>o("option",{value:"家庭"},"家庭",-1)),wo=l(()=>o("option",{value:"派對"},"派對",-1)),xo=l(()=>o("option",{value:"陣營"},"陣營",-1)),Lo=l(()=>o("option",{value:"雙人"},"雙人",-1)),Co=l(()=>o("option",{value:"合作"},"合作",-1)),Io=l(()=>o("option",{value:"劇情"},"劇情",-1)),Go={class:"col-3"},Mo=l(()=>o("label",{for:"productUnit",class:"form-label"},"單位:",-1)),So={class:"col-3"},Bo=l(()=>o("label",{for:"productStock",class:"form-label"},"數量：",-1)),To={class:"col-6"},Eo=l(()=>o("label",{for:"productOriginPrice",class:"form-label"},"原價：",-1)),Do={class:"col-6"},No=l(()=>o("label",{for:"productPrice",class:"form-label"},"售價：",-1)),Ro={class:"col-6"},Ao=l(()=>o("label",{for:"productLanguage",class:"form-label"},"語言：",-1)),Fo=l(()=>o("option",{selected:"",value:"繁中"},"繁中",-1)),qo=l(()=>o("option",{value:"簡中"},"簡中",-1)),Oo=l(()=>o("option",{value:"英文"},"英文",-1)),Ho=[Fo,qo,Oo],jo={class:"col-6"},zo=l(()=>o("label",{for:"productCondition",class:"form-label"},"盒況：",-1)),Jo=l(()=>o("option",{selected:"",value:"盒損"},"盒損",-1)),Ko=l(()=>o("option",{value:"件損"},"件損",-1)),Qo=l(()=>o("option",{value:"完好"},"完好",-1)),Wo=l(()=>o("option",{value:"其他"},"其他",-1)),Xo=[Jo,Ko,Qo,Wo],Yo={class:"col-12"},Zo=l(()=>o("label",{for:"BGG連結",class:"form-label"},"BGG連結：",-1)),$o={key:0},oe=["href"],ee=l(()=>o("hr",null,null,-1)),te={class:"col-12"},se=l(()=>o("label",{for:"productDescription",class:"form-label"},"描述：",-1)),le={class:"col-12"},de=l(()=>o("label",{for:"productContent",class:"form-label"},"內容：",-1)),ie={class:"custom-checkbox"},ae=l(()=>o("label",{for:"is_enabled",class:"form-label d-block"},"是否啟用：",-1)),ne={class:"modal-footer"},ce=l(()=>o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),re=["disabled"],ue={key:0},me={key:1};function _e(i,e,r,p,t,u){const m=v("VField"),_=v("ErrorMessage"),U=v("VForm");return n(),c("div",H,[o("div",j,[o("div",z,[o("div",J,[o("h2",K,[r.isNew?(n(),c("span",Q,"新增商品")):(n(),c("span",W,"編輯商品"))]),X]),o("div",Y,[a(U,{onSubmit:u.updateProduct,id:"productForm"},{default:C(({errors:d})=>[o("div",Z,[o("div",$,[o("div",oo,[eo,a(m,{id:"productImage",name:"主要圖片",type:"text",class:b(["form-control",{"is-invalid":d.主要圖片}]),placeholder:"請輸入 主要圖片網址",rules:"required",modelValue:t.modalProduct.imageUrl,"onUpdate:modelValue":e[0]||(e[0]=s=>t.modalProduct.imageUrl=s)},null,8,["class","modelValue"]),a(_,{name:"主要圖片",class:"invalid-feedback"}),o("div",to,[o("input",{class:"form-control",type:"file",ref:"mainImage",onChange:e[1]||(e[1]=s=>u.uploadImage("main")),disabled:t.imageLoading},null,40,so)]),o("img",{src:t.modalProduct.imageUrl,alt:"main product image"},null,8,lo)]),o("div",null,[io,Array.isArray(t.modalProduct.imagesUrl)?(n(),c("div",ao,[(n(!0),c(V,null,B(t.modalProduct.imagesUrl,(s,P)=>(n(),c(V,{key:s+P},[o("div",no,[o("label",{for:s,class:"form-label"},"圖片網址"+h(P+1),9,co),o("button",{type:"button",class:"btn-close btn-sm ms-auto","aria-label":"removeImage",onClick:L=>t.modalProduct.imagesUrl.splice(P,1)},null,8,ro)]),f(o("input",{type:"text",placeholder:"請輸入圖片連結",class:"form-control mb-1","onUpdate:modelValue":L=>t.modalProduct.imagesUrl[P]=L,id:s},null,8,uo),[[y,t.modalProduct.imagesUrl[P]]]),o("img",{src:s,alt:"product images",class:"img-fluid mb-4"},null,8,mo)],64))),128)),t.modalProduct.imagesUrl[t.modalProduct.imagesUrl.length-1]||!t.modalProduct.imagesUrl.length?(n(),c("div",_o,[o("button",{class:"btn btn-outline-themeDark w-100 mb-3",type:"button",onClick:e[2]||(e[2]=s=>t.modalProduct.imagesUrl.push(""))},"新增圖片網址"),po,o("div",ho,[o("input",{class:"form-control",type:"file",ref:"multiImage",onChange:e[3]||(e[3]=s=>u.uploadImage("multi")),disabled:t.imageLoading},null,40,go)])])):k("",!0)])):k("",!0)])]),o("div",bo,[o("div",fo,[o("div",vo,[Po,a(m,{id:"productTitle",name:"商品名稱",type:"text",class:b(["form-control",{"is-invalid":d.商品名稱}]),placeholder:"請輸入 商品名稱",rules:"required",modelValue:t.modalProduct.title,"onUpdate:modelValue":e[4]||(e[4]=s=>t.modalProduct.title=s)},null,8,["class","modelValue"]),a(_,{name:"商品名稱",class:"invalid-feedback"})]),o("div",yo,[Vo,a(m,{id:"productCategory",name:"分類",class:b(["form-control",{"is-invalid":d.分類}]),placeholder:"請輸入 分類",rules:"required",modelValue:t.modalProduct.category,"onUpdate:modelValue":e[5]||(e[5]=s=>t.modalProduct.category=s),as:"select"},{default:C(()=>[Uo,ko,wo,xo,Lo,Co,Io]),_:2},1032,["class","modelValue"]),a(_,{name:"分類",class:"invalid-feedback"})]),o("div",Go,[Mo,a(m,{id:"productUnit",name:"單位",type:"text",class:b(["form-control",{"is-invalid":d.單位}]),placeholder:"請輸入 單位",rules:"required",modelValue:t.modalProduct.unit,"onUpdate:modelValue":e[6]||(e[6]=s=>t.modalProduct.unit=s)},null,8,["class","modelValue"]),a(_,{name:"單位",class:"invalid-feedback"})]),o("div",So,[Bo,a(m,{id:"productStock",name:"數量",type:"number",class:b(["form-control",{"is-invalid":d.數量}]),placeholder:"請輸入 數量",rules:"required",modelValue:t.modalProduct.stock,"onUpdate:modelValue":e[7]||(e[7]=s=>t.modalProduct.stock=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),a(_,{name:"數量",class:"invalid-feedback"})]),o("div",To,[Eo,a(m,{id:"productOriginPrice",name:"原價",type:"number",class:b(["form-control",{"is-invalid":d.原價}]),placeholder:"請輸入 原價",rules:{min_value:0,required:!0},modelValue:t.modalProduct.origin_price,"onUpdate:modelValue":e[8]||(e[8]=s=>t.modalProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),a(_,{name:"原價",class:"invalid-feedback"})]),o("div",Do,[No,a(m,{id:"productPrice",name:"售價",type:"number",class:b(["form-control",{"is-invalid":d.售價}]),placeholder:"請輸入 售價",rules:{min_value:0,required:!0},modelValue:t.modalProduct.price,"onUpdate:modelValue":e[9]||(e[9]=s=>t.modalProduct.price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),a(_,{name:"售價",class:"invalid-feedback"})]),o("div",Ro,[Ao,f(o("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":e[10]||(e[10]=s=>t.modalProduct.language=s),id:"productLanguage"},Ho,512),[[I,t.modalProduct.language]])]),o("div",jo,[zo,f(o("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":e[11]||(e[11]=s=>t.modalProduct.condition=s),id:"productCondition"},Xo,512),[[I,t.modalProduct.condition]])]),o("div",Yo,[Zo,f(o("input",{type:"text",name:"BGGLink",id:"BGG連結",class:"form-control",placeholder:"請輸入 BGG 連結","onUpdate:modelValue":e[12]||(e[12]=s=>t.modalProduct.BGGLink=s)},null,512),[[y,t.modalProduct.BGGLink,void 0,{number:!0}]])]),t.modalProduct.BGGLink?(n(),c("div",$o,[A(" 測試："),o("a",{href:t.modalProduct.BGGLink,target:"_blank"},"連結",8,oe)])):k("",!0),ee,o("div",te,[se,f(o("textarea",{id:"productDescription",rows:"8",class:"form-control","onUpdate:modelValue":e[13]||(e[13]=s=>t.modalProduct.description=s)},null,512),[[y,t.modalProduct.description,void 0,{trim:!0}]])]),o("div",le,[de,f(o("textarea",{id:"productContent",rows:"3",class:"form-control","onUpdate:modelValue":e[14]||(e[14]=s=>t.modalProduct.content=s)},null,512),[[y,t.modalProduct.content,void 0,{trim:!0}]])]),o("div",ie,[ae,f(o("input",{type:"checkbox",id:"is_enabled","onUpdate:modelValue":e[15]||(e[15]=s=>t.modalProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[F,t.modalProduct.is_enabled]])])])])])]),_:1},8,["onSubmit"])]),o("div",ne,[ce,o("button",{type:"submit",class:"btn btn-themeDark",disabled:t.isLoading,form:"productForm"},[r.isNew?(n(),c("span",ue,"新增")):(n(),c("span",me,"修改"))],8,re)])])])])}const pe=S(O,[["render",_e],["__scopeId","data-v-5de54c46"]]);var he={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:G,VITE_PATH:M}=he,ge={components:{PaginationComponent:N,ProductModal:pe},data(){return{products:[],tempProduct:{imagesUrl:[],imageUrl:""},isNew:!0,page:{},isLoading:!1}},methods:{async getProducts(i=1){this.isLoading=!0;try{const e=await this.axios.get(`${G}/v2/api/${M}/admin/products?page=${i}`);this.products=e.data.products,this.page=e.data.pagination}catch(e){g.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}},deleteProduct(i){g.fire({title:`確定要刪除 ${i.title} 嗎?`,icon:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定",confirmButtonColor:"hsl(0,85%,60%)"}).then(async e=>{if(e.isConfirmed){this.isLoading=!0;try{const r=await this.axios.delete(`${G}/v2/api/${M}/admin/product/${i.id}`);g.fire({title:"刪除成功",icon:"success",text:`${r.data.message}`,showConfirmButton:!1,timer:1e3,didClose:()=>{this.getProducts()}})}catch(r){g.fire({title:"錯誤發生",icon:"error",text:`${r.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}}})},addNewProduct(){this.isNew=!0,this.tempProduct={imagesUrl:[],imageUrl:""}},editProduct(i){this.isNew=!1,this.tempProduct=i}},mounted(){this.getProducts()}},D=i=>(T("data-v-5fe18fb8"),i=i(),E(),i),be={class:"py-4"},fe=D(()=>o("h2",{class:"h2 text-center"},"商品列表",-1)),ve={class:"text-end mb-4"},Pe={class:"table-responsive"},ye={class:"table table-hover align-middle"},Ve=D(()=>o("thead",null,[o("tr",null,[o("th",{scope:"col"},"圖片"),o("th",{scope:"col"},"名稱"),o("th",{scope:"col"},"類型"),o("th",{scope:"col"},"語言"),o("th",{scope:"col"},"盒況"),o("th",{scope:"col"},"原價"),o("th",{scope:"col"},"售價"),o("th",{scope:"col"},"庫存"),o("th",{scope:"col"},"啟用"),o("th",{scope:"col"},"編輯")])],-1)),Ue={class:"table-group-divider"},ke=["src"],we={key:0,class:"text-theme"},xe={key:1,class:"text-danger"},Le=["onClick"],Ce=["onClick"];function Ie(i,e,r,p,t,u){const m=v("VLoading"),_=v("PaginationComponent"),U=v("ProductModal");return n(),c(V,null,[a(m,{active:t.isLoading},null,8,["active"]),o("div",be,[fe,o("div",ve,[o("button",{type:"button",class:"btn btn-themeDark","data-bs-toggle":"modal","data-bs-target":"#productModal",onClick:e[0]||(e[0]=(...d)=>u.addNewProduct&&u.addNewProduct(...d))},"建立新產品")])]),o("div",Pe,[o("table",ye,[Ve,o("tbody",Ue,[(n(!0),c(V,null,B(t.products,d=>(n(),c("tr",{key:d.id},[o("td",null,[o("img",{src:d.imageUrl,alt:"productImage",class:"product-image"},null,8,ke)]),o("td",null,h(d.title),1),o("td",null,h(d.category),1),o("td",null,h(d.language),1),o("td",null,h(d.condition),1),o("td",null,h(d.origin_price),1),o("td",null,h(d.price),1),o("td",null,h(d.stock),1),o("td",null,[d.is_enabled?(n(),c("span",we,"啟用")):(n(),c("span",xe,"未啟用"))]),o("td",null,[o("button",{type:"button",class:"btn btn-outline-theme btn-sm me-2","data-bs-toggle":"modal","data-bs-target":"#productModal",onClick:s=>u.editProduct(d)}," 編輯 ",8,Le),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:s=>u.deleteProduct(d)}," 刪除 ",8,Ce)])]))),128))])])]),a(_,{pages:t.page,onGetMethod:u.getProducts},null,8,["pages","onGetMethod"]),a(U,{"is-new":t.isNew,"temp-product":t.tempProduct,onGetProducts:u.getProducts},null,8,["is-new","temp-product","onGetProducts"])],64)}const Se=S(ge,[["render",Ie],["__scopeId","data-v-5fe18fb8"]]);export{Se as default};
