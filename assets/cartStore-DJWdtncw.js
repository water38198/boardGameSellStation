import{I as l,J as s,S as a}from"./index-3cozGc54.js";function f(){function t(o){let e=o;e&&e.toString().length<13&&(e*=1e3);const r=new Date(e),i=r.getMonth()+1<10?`0${r.getMonth()+1}`:r.getMonth()+1,d=r.getDate()<10?`0${r.getDate()}`:r.getDate();return`${r.getFullYear()}-${i}-${d}`}return{timeTransform:t}}var m={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:n,VITE_PATH:c}=m,{timeTransform:h}=f(),p=l("cartStore",{state:()=>({cart:[],cartLoading:!1,loadingItem:"",coupon:""}),actions:{async getCarts(){this.cartLoading=!0;try{const t=await s.get(`${n}/v2/api/${c}/cart`);this.cart=t.data.data}catch(t){a.fire({title:"錯誤發生",icon:"error",text:`${t.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.cartLoading=!1}},async addToCart(t,o=1){this.loadingItem=t.id;const e={product_id:t.id,qty:o},r=this.cart.carts.find(i=>i.product_id===t.id);if(r&&r.product.stock<r.qty+o){a.fire({title:"出超庫存數量",icon:"error",confirmButtonColor:"#0FB99B"}),this.loadingItem="";return}this.loadingItem=t.id;try{const i=await s.post(`${n}/v2/api/${c}/cart`,{data:e});a.fire({position:"bottom-right",icon:"success",title:`${i.data.message}`,showConfirmButton:!1,toast:!0,timer:1500})}catch(i){a.fire({title:"錯誤發生",icon:"error",text:`${i.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.getCarts(),this.loadingItem=""}},async updateItemNum(t){this.cartLoading=!0;const o={product_id:t.product.id,qty:t.qty};try{const e=await s.put(`${n}/v2/api/${c}/cart/${t.id}`,{data:o});this.cartLoading=!1,a.fire({icon:"success",title:`${e.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.getCarts()}})}catch(e){a.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.cartLoading=!1}},deleteCartItem(t){this.loadingItem=t,a.fire({icon:"question",title:"確定要刪除嗎",showCancelButton:!0,confirmButtonText:"確定刪除",confirmButtonColor:"red",cancelButtonText:"我再想想"}).then(async o=>{if(o.isConfirmed)try{const e=await s.delete(`${n}/v2/api/${c}/cart/${t}`);a.fire({icon:"success",title:`${e.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.getCarts()}})}catch(e){a.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}})},deleteCartAll(){this.loadingItem="all",a.fire({title:"確定嗎?",text:"你確定要清空購物車嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"red",confirmButtonText:"確定",cancelButtonText:"取消",didClose:()=>{this.loadingItem=""}}).then(t=>{t.isConfirmed&&s.delete(`${n}/v2/api/${c}/carts`).then(()=>{a.fire("刪除成功!","購物車已清空","success"),this.getCarts()}).catch(o=>{a.fire({title:"錯誤發生",icon:"error",text:`${o.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})})})},useCoupon(t){const o={data:{code:t}};s.post(`${n}/v2/api/${c}/coupon`,o).then(()=>{this.getCarts()}).catch(()=>a.fire({icon:"error",title:"哇...",text:"優惠券代碼錯誤!請確認"}))},sendOrder(t){const o={user:t};s.post(`${n}/v2/api/${c}/order`,{data:o}).then(e=>{a.fire({title:e.data.message,html:`<div class='container'><div class="row text-start">
      <div class="col-4">
        <p class="text-theme">訂單ID:</p>
        <p class="text-theme">建立時間:</p>
        <p class="text-theme">總金額:</p>
      </div>
      <div class="col-8">
        <p>${e.data.orderId}</p>
        <p>${h(e.data.create_at)}</p>
        <p>$${e.data.total}</p>
      </div>
    </div></div>  
              `,confirmButtonColor:"#0FB99B"}),this.getCarts()}).catch(e=>{a.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})})}}});export{p as c};
