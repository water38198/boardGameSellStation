import{P as S}from"./PaginationComponent-DRClpUxD.js";import{_ as k,S as m,M as $,o as d,c as r,a as e,e as c,w as C,n as b,r as _,p as T,d as L,F as v,i as I,k as D,f as N,t as f}from"./index-BpZpzotS.js";var B={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:y,VITE_PATH:V}=B,U={props:{isNew:{type:Boolean},tempCoupon:{type:Object}},data(){return{modalCoupon:{},isLoading:!1,modal:null}},methods:{async updateCoupon(){this.isLoading=!0;const o=this.isNew?"post":"put",t=this.isNew?`${y}/v2/api/${V}/admin/coupon`:`${y}/v2/api/${V}/admin/coupon/${this.modalCoupon.id}`;try{const n=await this.axios[o](t,{data:this.modalCoupon});n.data.success?m.fire({title:`${n.data.message}`,icon:"success",showConfirmButton:!1,timer:1500,didClose:()=>{this.$emit("getCoupons"),this.modal.hide()}}):m.fire({title:"錯誤發生",icon:"error",text:`${n.data.message}`})}catch(n){m.fire({title:"錯誤發生",icon:"error",text:`${n.response.data.message}`})}finally{this.isLoading=!1}},changeDate(o){this.modalCoupon.due_date=o.target.valueAsNumber/1e3,console.log(123)}},watch:{tempCoupon(){this.modalCoupon={...this.tempCoupon},this.modalCoupon.due_date||(this.modalCoupon.due_date=new Date().getTime())}},mounted(){this.modal=new $("#couponModal")}},u=o=>(T("data-v-b9ba1765"),o=o(),L(),o),P={class:"modal fade",id:"couponModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-dialog-centered modal-xl"},A={class:"modal-content"},F={class:"modal-header bg-light"},G={class:"modal-title",id:"couponModalLabel"},H={key:0},O={key:1},q=u(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),j={class:"modal-body"},z={class:"row gy-4"},J={class:"col-md-6 col-lg-4"},K=u(()=>e("label",{for:"title",class:"form-label"},"優惠券名稱：",-1)),Q={class:"col-md-6 col-lg-4"},W=u(()=>e("label",{for:"percent",class:"form-label"},"折扣比例：",-1)),X={class:"col-md-6 col-lg-4"},Y=u(()=>e("label",{for:"is_enabled",class:"form-label"},"狀態:",-1)),Z=u(()=>e("option",{value:0,selected:"",class:"text-danger"},"未啟用",-1)),ee=u(()=>e("option",{value:1,class:"text-success"},"啟用",-1)),oe={class:"col-md-6 col-lg-4"},te=u(()=>e("label",{for:"code",class:"form-label"},"折扣碼:",-1)),se={class:"col-md-6 col-lg-4"},ae=u(()=>e("label",{for:"due_date",class:"form-label"},"到期日:",-1)),ne=["min","value"],le={class:"modal-footer"},de=u(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1)),ie=["disabled"],ce={key:0},re={key:1};function ue(o,t,n,E,s,i){const p=_("VField"),h=_("ErrorMessage"),g=_("VForm");return d(),r("div",P,[e("div",R,[e("div",A,[e("div",F,[e("h2",G,[n.isNew?(d(),r("span",H,"新增優惠券")):(d(),r("span",O,"編輯優惠券"))]),q]),e("div",j,[c(g,{onSubmit:i.updateCoupon,id:"couponForm"},{default:C(({errors:a})=>[e("div",z,[e("div",J,[K,c(p,{id:"title",name:"優惠券名稱",type:"text",class:b(["form-control",{"is-invalid":a.優惠券名稱}]),placeholder:"請輸入 優惠券名稱",rules:"required",modelValue:s.modalCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=l=>s.modalCoupon.title=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),c(h,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",Q,[W,c(p,{id:"percent",name:"折扣比例",type:"number",class:b(["form-control",{"is-invalid":a.折扣比例}]),placeholder:"請輸入 折扣比例",rules:{min_value:0,max_value:99,required:!0},modelValue:s.modalCoupon.percent,"onUpdate:modelValue":t[1]||(t[1]=l=>s.modalCoupon.percent=l),modelModifiers:{trim:!0,number:!0}},null,8,["class","modelValue"])]),e("div",X,[Y,c(p,{id:"is_enabled",name:"狀態",class:b(["form-control",{"is-invalid":a.狀態,"text-success":s.modalCoupon.is_enabled,"text-danger":s.modalCoupon.is_enabled===0}]),placeholder:"請輸入 狀態",rules:"required",modelValue:s.modalCoupon.is_enabled,"onUpdate:modelValue":t[2]||(t[2]=l=>s.modalCoupon.is_enabled=l),as:"select"},{default:C(()=>[Z,ee]),_:2},1032,["class","modelValue"]),c(h,{name:"狀態",class:"invalid-feedback"})]),e("div",oe,[te,c(p,{id:"code",name:"折扣碼",type:"text",class:b(["form-control",{"is-invalid":a.折扣碼}]),placeholder:"請輸入折扣碼，如:Test123",rules:"required",modelValue:s.modalCoupon.code,"onUpdate:modelValue":t[3]||(t[3]=l=>s.modalCoupon.code=l)},null,8,["class","modelValue"]),c(h,{name:"折扣碼",class:"invalid-feedback"})]),e("div",se,[ae,e("input",{type:"date",id:"due_date",name:"到期日",class:"date-input",pattern:"yyyy-MM-dd",min:o.$timeTransform(new Date().getTime()),value:o.$timeTransform(s.modalCoupon.due_date),onInput:t[4]||(t[4]=(...l)=>i.changeDate&&i.changeDate(...l))},null,40,ne)])])]),_:1},8,["onSubmit"])]),e("div",le,[de,e("button",{type:"submit",class:"btn btn-themeDark",disabled:s.isLoading,form:"couponForm"},[n.isNew?(d(),r("span",ce,"新增")):(d(),r("span",re,"修改"))],8,ie)])])])])}const me=k(U,[["render",ue],["__scopeId","data-v-b9ba1765"]]);var pe={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:x}=pe,_e={components:{PaginationComponent:S,CouponModal:me},data(){return{coupons:[],page:{},isNew:!0,tempCoupon:{},isLoading:!1}},methods:{async getCoupons(o=1){this.isLoading=!0;try{const t=await this.axios.get(`${w}/v2/api/${x}/admin/coupons?page=${o}`);this.coupons=t.data.coupons,this.page=t.data.pagination}catch(t){m.fire({title:"錯誤發生",icon:"error",text:`${t.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}},addNewCoupon(){this.isNew=!0,this.tempCoupon={}},editCoupon(o){this.isNew=!1,this.tempCoupon={...o}},deleteCoupon(o){m.fire({title:`確定要刪除${o.title}嗎`,icon:"warning",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確定",confirmButtonColor:"hsl(0,85%,70%)"}).then(async t=>{if(t.isConfirmed){this.isLoading=!0;try{const n=await this.axios.delete(`${w}/v2/api/${x}/admin/coupon/${o.id}`);m.fire({title:"刪除成功",icon:"success",text:`${n.data.message}`,showConfirmButton:!1,timer:1e3,didClose:()=>{this.getCoupons()}})}catch(n){m.fire({title:"錯誤發生",icon:"error",text:`${n.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.isLoading=!1}}})}},mounted(){this.getCoupons()}},M=o=>(T("data-v-710e1b4d"),o=o(),L(),o),he={class:"py-4"},be=M(()=>e("h2",{class:"h2 text-center"},"優惠券列表",-1)),fe={class:"text-end mb-4"},ge={class:"table-responsive"},Ce={class:"table table-hover align-middle"},ve=M(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"啟用"),e("th",{scope:"col"},"比例"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"折扣碼"),e("th",{scope:"col",width:"120px"},"管理")])],-1)),ye={key:0,class:"text-success"},Ve={key:1,class:"text-danger"},we=["onClick"],xe=["onClick"];function ke(o,t,n,E,s,i){const p=_("VLoading"),h=_("PaginationComponent"),g=_("CouponModal");return d(),r(v,null,[c(p,{active:s.isLoading},null,8,["active"]),e("div",he,[be,e("div",fe,[e("button",{type:"button",class:"btn btn-themeDark","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:t[0]||(t[0]=(...a)=>i.addNewCoupon&&i.addNewCoupon(...a))},"建立新優惠券")])]),e("div",ge,[e("table",Ce,[ve,e("tbody",null,[(d(!0),r(v,null,I(s.coupons,a=>(d(),r("tr",{key:a.id},[e("td",null,f(a.title),1),e("td",null,[a.is_enabled?(d(),r("span",ye,"啟用")):(d(),r("span",Ve,"關閉"))]),e("td",null,f(a.percent),1),e("td",null,f(o.$timeTransform(a.due_date)),1),e("td",null,f(a.code),1),e("td",null,[e("button",{class:"btn btn-outline-themeDark btn-sm me-2",type:"button","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:l=>i.editCoupon(a)},"編輯",8,we),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:l=>i.deleteCoupon(a)},"刪除",8,xe)])]))),128))])])]),s.page.total_page>1?(d(),D(h,{key:0,pages:s.page,onGetMethod:i.getCoupons},null,8,["pages","onGetMethod"])):N("",!0),c(g,{"is-new":s.isNew,"temp-coupon":s.tempCoupon,onGetCoupons:i.getCoupons},null,8,["is-new","temp-coupon","onGetCoupons"])],64)}const Me=k(_e,[["render",ke],["__scopeId","data-v-710e1b4d"]]);export{Me as default};
