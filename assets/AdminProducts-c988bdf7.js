import{P as D}from"./PaginationComponent-262700be.js";import{S as U}from"./sweetalert2.all-456922e1.js";import{_ as E,r as P,o as c,c as a,a as e,g as n,w as C,s as g,v,F as y,j as L,t as h,h as V,q as f,x as k,K as A,M as N,p as R,i as q}from"./index-25a7f1be.js";const{VITE_URL:I,VITE_PATH:x}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},F={props:["tempProduct","isNew","closeModal","getProducts"],data(){return{newProduct:{},loadingItem:"",tempPrice:0}},methods:{updateProduct(){this.loadingItem="confirmButton";let l="post",t=`${I}/v2/api/${x}/admin/product`;this.isNew||(t+=`/${this.tempProduct.id}`,l="put"),this.setPriceHistory(),this.$http[l](t,{data:this.newProduct}).then(()=>{U.fire({icon:"success",title:`${l==="put"?"修改成功":"新增成功"}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.closeModal(),this.getProducts()}})}).catch(d=>{console.log(d)}).finally(()=>{this.loadingItem=""})},setPriceHistory(){let l={},t=new Date().getTime();l[t]=this.newProduct.price,this.isNew?(this.newProduct.history=[],this.newProduct.history.push(l)):this.tempPrice>this.newProduct.price&&this.newProduct.history.push(l)},uploadImage(l){let t=document.querySelector("#formFile");this.loadingItem="images",l==="main"&&(t=document.querySelector("#mainImage"),this.loadingItem="mainImage");const d=new FormData;d.append("file-to-upload",t.files[0]),this.$http.post(`${I}/v2/api/${x}/admin/upload`,d).then(m=>{m.data.imageUrl?l==="main"?this.newProduct.imageUrl=m.data.imageUrl:l==="multi"&&this.newProduct.imagesUrl.push(m.data.imageUrl):alert(m.data.message),t.value="",this.loadingItem=""}).catch(m=>{alert(m)})}},watch:{tempProduct(){this.newProduct={...this.tempProduct},this.tempPrice=this.tempProduct.price}}},H={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},O={class:"modal-content"},j={class:"modal-header bg-light"},z={class:"modal-title",id:"productModalLabel"},G={key:0},K={key:1},W={class:"modal-body"},J={class:"col-4"},Q={class:"mb-5"},X=e("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),Y={class:"mb-3"},Z=["disabled"],$=["src"],ee=e("h4",null,"多圖新增",-1),te={key:0},oe={class:"d-flex justify-content-space-between"},se=["for"],le=["onClick"],ie=["onUpdate:modelValue","id"],ne=["src"],de={key:0},ce=e("p",{class:"text-center"},"或",-1),ae={class:"mb-3"},re=["disabled"],ue={class:"col-8"},me={class:"row gy-3"},pe={class:"col-12"},_e=e("label",{for:"productTitle",class:"form-label"},"商品名稱:",-1),he={class:"col-6"},ge=e("label",{for:"productCategory",class:"form-label"},"分類:",-1),fe=e("option",{selected:"",value:"策略"},"策略",-1),be=e("option",{value:"家庭"},"家庭",-1),Pe=e("option",{value:"派對"},"派對",-1),ve=e("option",{value:"陣營"},"陣營",-1),we=e("option",{value:"雙人"},"雙人",-1),ye=e("option",{value:"合作"},"合作",-1),Ue=e("option",{value:"劇情"},"劇情",-1),Ve={class:"col-3"},Me=e("label",{for:"productUnit",class:"form-label"},"單位:",-1),Ce={class:"col-3"},ke=e("label",{for:"productStock",class:"form-label"},"數量:",-1),Ie={class:"col-6"},xe=e("label",{for:"productOriginPrice",class:"form-label"},"原價:",-1),Se={class:"col-6"},Te=e("label",{for:"productPrice",class:"form-label"},"售價:",-1),Ee={class:"col-4"},Le=e("label",{for:"productLanguage",class:"form-label"},"語言",-1),Be=e("option",{selected:"",value:"繁中"},"繁中",-1),De=e("option",{value:"簡中"},"簡中",-1),Ae=e("option",{value:"英文"},"英文",-1),Ne=[Be,De,Ae],Re={class:"col-4"},qe=e("label",{for:"productCondition",class:"form-label"},"盒況",-1),Fe=e("option",{selected:"",value:"盒損"},"盒損",-1),He=e("option",{value:"件損"},"件損",-1),Oe=e("option",{value:"完好"},"完好",-1),je=e("option",{value:"其他"},"其他",-1),ze=[Fe,He,Oe,je],Ge=e("hr",null,null,-1),Ke={class:"col-12"},We=e("label",{for:"productDescription",class:"form-label"},"描述:",-1),Je={class:"col-12"},Qe=e("label",{for:"productContent",class:"form-label"},"內容:",-1),Xe=e("label",{for:"is_enabled",class:"form-label"},"是否啟用",-1),Ye={class:"modal-footer"},Ze=["disabled"];function $e(l,t,d,m,o,u){const p=P("VField"),_=P("ErrorMessage"),i=P("VForm");return c(),a("div",H,[e("div",O,[e("div",j,[e("h5",z,[d.isNew?(c(),a("span",G,"新增產品")):(c(),a("span",K,"編輯產品"))]),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=r=>d.closeModal()),"aria-label":"Close"})]),e("div",W,[n(i,{onSubmit:u.updateProduct,class:"row",ref:"ProductModal",id:"ProductModal"},{default:C(({errors:r})=>[e("div",J,[e("div",Q,[X,g(e("input",{type:"text",placeholder:"請輸入圖片連結",id:"imageUrl",class:"form-control mb-2","onUpdate:modelValue":t[1]||(t[1]=s=>o.newProduct.imageUrl=s)},null,512),[[v,o.newProduct.imageUrl]]),e("div",Y,[e("input",{class:"form-control",type:"file",id:"mainImage",onChange:t[2]||(t[2]=s=>u.uploadImage("main")),disabled:o.loadingItem==="mainImage"},null,40,Z)]),e("img",{src:o.newProduct.imageUrl,alt:"",class:"img-fluid"},null,8,$)]),e("div",null,[ee,Array.isArray(o.newProduct.imagesUrl)?(c(),a("div",te,[(c(!0),a(y,null,L(o.newProduct.imagesUrl,(s,b)=>(c(),a(y,{key:b+5566},[e("div",oe,[e("label",{for:s,class:"form-label"},"圖片網址"+h(b+1),9,se),e("button",{type:"button",class:"btn-close btn-sm ms-auto","aria-label":"removeImage",onClick:M=>o.newProduct.imagesUrl.splice(b,1)},null,8,le)]),g(e("input",{type:"text",placeholder:"請輸入圖片連結",class:"form-control mb-1","onUpdate:modelValue":M=>o.newProduct.imagesUrl[b]=M,id:s},null,8,ie),[[v,o.newProduct.imagesUrl[b]]]),e("img",{src:s,alt:"",class:"img-fluid mb-4"},null,8,ne)],64))),128)),o.newProduct.imagesUrl[o.newProduct.imagesUrl.length-1]||!o.newProduct.imagesUrl.length?(c(),a("div",de,[e("button",{class:"btn btn-outline-primary w-100 mb-3",type:"button",onClick:t[3]||(t[3]=s=>o.newProduct.imagesUrl.push(""))}," 新增圖片網址 "),ce,e("div",ae,[e("input",{class:"form-control",type:"file",id:"formFile",onChange:t[4]||(t[4]=s=>u.uploadImage("multi")),disabled:o.loadingItem==="images"},null,40,re)])])):V("",!0)])):V("",!0)])]),e("div",ue,[e("div",me,[e("div",pe,[_e,n(p,{id:"productTitle",name:"商品名稱",type:"text",class:f(["form-control",{"is-invalid":r.商品名稱}]),placeholder:"請輸入 商品名稱",rules:"required",modelValue:o.newProduct.title,"onUpdate:modelValue":t[5]||(t[5]=s=>o.newProduct.title=s)},null,8,["class","modelValue"]),n(_,{name:"商品名稱",class:"invalid-feedback"})]),e("div",he,[ge,n(p,{id:"productCategory",name:"分類",class:f(["form-control",{"is-invalid":r.分類}]),placeholder:"請輸入 分類",rules:"required",modelValue:o.newProduct.category,"onUpdate:modelValue":t[6]||(t[6]=s=>o.newProduct.category=s),as:"select"},{default:C(()=>[fe,be,Pe,ve,we,ye,Ue]),_:2},1032,["class","modelValue"]),n(_,{name:"分類",class:"invalid-feedback"})]),e("div",Ve,[Me,n(p,{id:"productUnit",name:"單位",type:"text",class:f(["form-control",{"is-invalid":r.單位}]),placeholder:"請輸入 單位",rules:"required",modelValue:o.newProduct.unit,"onUpdate:modelValue":t[7]||(t[7]=s=>o.newProduct.unit=s)},null,8,["class","modelValue"]),n(_,{name:"單位",class:"invalid-feedback"})]),e("div",Ce,[ke,n(p,{id:"productStock",name:"數量",type:"number",class:f(["form-control",{"is-invalid":r.數量}]),placeholder:"請輸入 數量",rules:"required",modelValue:o.newProduct.stock,"onUpdate:modelValue":t[8]||(t[8]=s=>o.newProduct.stock=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(_,{name:"數量",class:"invalid-feedback"})]),e("div",Ie,[xe,n(p,{id:"productOriginPrice",name:"原價",type:"number",class:f(["form-control",{"is-invalid":r.原價}]),placeholder:"請輸入 原價",rules:{min_value:0,required:!0},modelValue:o.newProduct.origin_price,"onUpdate:modelValue":t[9]||(t[9]=s=>o.newProduct.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(_,{name:"原價",class:"invalid-feedback"})]),e("div",Se,[Te,n(p,{id:"productPrice",name:"售價",type:"number",class:f(["form-control",{"is-invalid":r.售價}]),placeholder:"請輸入 售價",rules:{min_value:0,required:!0},modelValue:o.newProduct.price,"onUpdate:modelValue":t[10]||(t[10]=s=>o.newProduct.price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(_,{name:"售價",class:"invalid-feedback"})]),e("div",Ee,[Le,g(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[11]||(t[11]=s=>o.newProduct.language=s),id:"productLanguage"},Ne,512),[[k,o.newProduct.language]])]),e("div",Re,[qe,g(e("select",{class:"form-select","aria-label":"tag","onUpdate:modelValue":t[12]||(t[12]=s=>o.newProduct.condition=s),id:"productCondition"},ze,512),[[k,o.newProduct.condition]])]),Ge,e("div",Ke,[We,g(e("textarea",{id:"productDescription",rows:"3",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=s=>o.newProduct.description=s)},null,512),[[v,o.newProduct.description]])]),e("div",Je,[Qe,g(e("textarea",{id:"productContent",rows:"3",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=s=>o.newProduct.content=s)},null,512),[[v,o.newProduct.content]])]),e("div",null,[g(e("input",{type:"checkbox",id:"is_enabled",class:"form-check-input","onUpdate:modelValue":t[15]||(t[15]=s=>o.newProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[A,o.newProduct.is_enabled]]),Xe])])])]),_:1},8,["onSubmit"])]),e("div",Ye,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[16]||(t[16]=(...r)=>d.closeModal&&d.closeModal(...r))}," 取消 "),e("button",{type:"submit",class:"btn btn-primary",disabled:o.loadingItem==="confirmButton",form:"ProductModal"}," 確認 ",8,Ze)])])])}const et=E(F,[["render",$e]]);const{VITE_URL:S,VITE_PATH:T}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let w={};const tt={data(){return{products:[],tempProduct:{imagesUrl:[],imageUrl:""},isNew:!0,page:{},isLoading:!1}},components:{PaginationComponent:D,ProductModal:et},methods:{getProducts(l=1){this.isLoading=!0,this.$http.get(`${S}/v2/api/${T}/admin/products?page=${l}`).then(t=>{this.products=t.data.products,this.page=t.data.pagination}).finally(()=>{this.isLoading=!1})},openModal(l,t){l==="new"?(this.isNew=!0,this.tempProduct={imageUrl:"",imagesUrl:[]},w.show()):l==="edit"&&(this.isNew=!1,this.tempProduct={...t},w.show()),this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])},closeModal(){this.tempProduct={imagesUrl:[]},w.hide()},deleteProduct(l,t){U.fire({title:`確定刪除 ${l} 嗎?`,text:"刪除後不可復原，確定嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonColor:"#d33",cancelButtonText:"取消"}).then(d=>{d.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${S}/v2/api/${T}/admin/product/${t}`).then(()=>{this.isLoading=!1,U.fire({icon:"success",title:`${l}刪除成功`,showConfirmButton:!1,timer:1e3,didClose:()=>{this.getProducts()}})}))})}},mounted(){var t;const l=(t=document.cookie.split("; ").find(d=>d.startsWith("myToken=")))==null?void 0:t.split("=")[1];this.$http.defaults.headers.common.Authorization=l,this.getProducts(),w=new N("#productModal")}},B=l=>(R("data-v-e3b43426"),l=l(),q(),l),ot={class:"row justify-content-center"},st={class:"col"},lt={class:"text-end"},it=B(()=>e("h2",{class:"h2 text-center"},"產品列表",-1)),nt={class:"table table-hover align-middle"},dt=B(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"類型"),e("th",{scope:"col"},"語言"),e("th",{scope:"col"},"盒況"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1)),ct=["src"],at={key:0,class:"text-success"},rt={key:1,class:"text-danger"},ut=["onClick"],mt=["onClick"],pt={colspan:"9",class:"text-center"},_t={class:"modal fade",id:"productModal","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"};function ht(l,t,d,m,o,u){const p=P("PaginationComponent"),_=P("ProductModal");return c(),a(y,null,[e("div",ot,[e("div",st,[e("div",lt,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=i=>u.openModal("new"))}," 建立新的產品 ")]),it,e("table",nt,[dt,e("tbody",null,[o.products?(c(!0),a(y,{key:0},L(o.products,i=>(c(),a("tr",{key:i.id},[e("td",null,[e("img",{src:i.imageUrl,alt:"productImage",class:"product-image",onerror:"this.src='../../../public/no_image_icon.png'"},null,8,ct)]),e("td",null,h(i.title),1),e("td",null,h(i.category),1),e("td",null,h(i.language),1),e("td",null,h(i.condition),1),e("td",null,h(i.origin_price),1),e("td",null,h(i.price),1),e("td",null,[i.is_enabled?(c(),a("span",at,"啟用")):(c(),a("span",rt,"未啟用"))]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm me-2",onClick:r=>u.openModal("edit",i)}," 編輯 ",8,ut),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>u.deleteProduct(i.title,i.id)}," 刪除 ",8,mt)])]))),128)):V("",!0)]),e("tfoot",null,[e("tr",null,[e("td",pt," 本頁有"+h(o.products.length)+"項產品 ",1)])])]),n(p,{pages:o.page,"get-Method":u.getProducts},null,8,["pages","get-Method"])])]),e("div",_t,[n(_,{"temp-product":o.tempProduct,"is-new":o.isNew,"close-Modal":u.closeModal,"get-Products":u.getProducts},null,8,["temp-product","is-new","close-Modal","get-Products"])])],64)}const Pt=E(tt,[["render",ht],["__scopeId","data-v-e3b43426"]]);export{Pt as default};
