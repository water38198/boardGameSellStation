import{I as d,J as i,S as a,K as l}from"./index-C-WNfngo.js";var f={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:r,VITE_PATH:o}=f,{timeTransform:m}=l(),p=d("cartStore",{state:()=>({cart:[],cartLoading:!1,loadingItem:"",coupon:""}),actions:{async getCarts(){this.cartLoading=!0;try{const t=await i.get(`${r}/v2/api/${o}/cart`);this.cart=t.data.data}catch(t){a.fire({title:"錯誤發生",icon:"error",text:`${t.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.cartLoading=!1}},async addToCart(t,s=1){this.loadingItem=t.id;const e={product_id:t.id,qty:s},c=this.cart.carts.find(n=>n.product_id===t.id);if(c&&c.product.stock<c.qty+s){a.fire({title:"出超庫存數量",icon:"error",confirmButtonColor:"#0FB99B"}),this.loadingItem="";return}this.loadingItem=t.id;try{const n=await i.post(`${r}/v2/api/${o}/cart`,{data:e});a.fire({position:"bottom-right",icon:"success",title:`${n.data.message}`,showConfirmButton:!1,toast:!0,timer:1500})}catch(n){a.fire({title:"錯誤發生",icon:"error",text:`${n.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.getCarts(),this.loadingItem=""}},async updateItemNum(t){this.cartLoading=!0;const s={product_id:t.product.id,qty:t.qty};try{const e=await i.put(`${r}/v2/api/${o}/cart/${t.id}`,{data:s});this.cartLoading=!1,a.fire({icon:"success",title:`${e.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.getCarts()}})}catch(e){a.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}finally{this.cartLoading=!1}},deleteCartItem(t){this.loadingItem=t,a.fire({icon:"question",title:"確定要刪除嗎",showCancelButton:!0,confirmButtonText:"確定刪除",confirmButtonColor:"red",cancelButtonText:"我再想想"}).then(async s=>{if(s.isConfirmed)try{const e=await i.delete(`${r}/v2/api/${o}/cart/${t}`);a.fire({icon:"success",title:`${e.data.message}`,showConfirmButton:!1,timer:1500,didClose:()=>{this.getCarts()}})}catch(e){a.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}})},deleteCartAll(){this.loadingItem="all",a.fire({title:"確定嗎?",text:"你確定要清空購物車嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"red",confirmButtonText:"確定",cancelButtonText:"取消",didClose:()=>{this.loadingItem=""}}).then(t=>{t.isConfirmed&&i.delete(`${r}/v2/api/${o}/carts`).then(()=>{a.fire("刪除成功!","購物車已清空","success"),this.getCarts()}).catch(s=>{a.fire({title:"錯誤發生",icon:"error",text:`${s.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})})})},useCoupon(t){const s={data:{code:t}};i.post(`${r}/v2/api/${o}/coupon`,s).then(()=>{this.getCarts()}).catch(()=>a.fire({icon:"error",title:"哇...",text:"優惠券代碼錯誤!請確認"}))},sendOrder(t){const s={user:t};i.post(`${r}/v2/api/${o}/order`,{data:s}).then(e=>{a.fire({title:e.data.message,html:`<div class='container'><div class="row text-start">
      <div class="col-4">
        <p class="text-theme">訂單ID:</p>
        <p class="text-theme">建立時間:</p>
        <p class="text-theme">總金額:</p>
      </div>
      <div class="col-8">
        <p>${e.data.orderId}</p>
        <p>${m(e.data.create_at)}</p>
        <p>$${e.data.total}</p>
      </div>
    </div></div>  
              `,confirmButtonColor:"#0FB99B"}),this.getCarts()}).catch(e=>{a.fire({title:"錯誤發生",icon:"error",text:`${e.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})})}}});export{p as c};
