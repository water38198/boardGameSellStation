import{P as T}from"./PaginationComponent-bb8ba716.js";import{S as _,m as M,_ as x,r as h,o as d,c as a,a as e,f as r,w as L,q as w,L as I,n as p,F as g,j as k,t as i,g as C,v as S,M as U}from"./index-288619d3.js";import{u as E}from"./utilities-5a299121.js";const{VITE_URL:B,VITE_PATH:D}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},P={props:["tempOrder","closeModal","getOrders"],data(){return{newOrder:{user:{},products:{}},loadingItem:""}},methods:{deleteOrderItem(n){if(Object.keys(this.newOrder.products).length===1){_.fire({icon:"error",title:"商品不得為空",showConfirmButton:!1,timer:1e3});return}this.newOrder.total-=this.newOrder.products[n].final_total,delete this.newOrder.products[n]},updateOrder(n,s){this.loadingItem=s;const f={data:{...{...n}}};this.$http.put(`${B}/v2/api/${D}/admin/order/${s}`,f).then(()=>{_.fire({icon:"success",title:"修改成功!",showConfirmButton:!1,timer:1e3,didClose:()=>{this.closeModal(),this.getOrders(),this.loadingItem=""}})}).catch(t=>{_.fire({title:"錯誤發生",icon:"error",text:`${t.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})})},...M(E,["timeTransform"])},watch:{tempOrder(){this.newOrder=JSON.parse(JSON.stringify(this.tempOrder))}}},R={class:"modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable"},A={class:"modal-content"},q={class:"modal-header bg-light"},F=e("h3",{class:"modal-title",id:"orderModalLabel"},"訂單詳細內容",-1),$={class:"modal-body px-5"},H=e("h5",{class:"h5 fw-bold"},"基本資訊",-1),N={class:"col-4"},j={class:"input-group mb-3"},G=e("span",{class:"input-group-text",id:"create_at"},"建立時間",-1),J=["value"],z={class:"col-4"},X={class:"input-group mb-3"},K=e("span",{class:"input-group-text",id:"id"},"ID",-1),Q=["value"],W={class:"col-4"},Y=e("span",{class:"me-2"},"付款狀態: ",-1),Z={key:0},ee={key:1},te=e("h5",{class:"h5 fw-bold"},"訂購商品資訊",-1),se={class:"col-12"},oe={class:"table align-middle"},le=e("thead",null,[e("tr",null,[e("th"),e("th",null,"商品名稱"),e("th",null,"數量"),e("th",{class:"text-end"},"單價"),e("th",{class:"text-end"},"總價")])],-1),ne={key:0},re=["onClick"],de={class:"text-end"},ae={class:"text-end"},ie={class:"text-end pe-2"},ce=e("h5",{class:"fw-bold"},"訂購人資訊",-1),ue={class:"col-4"},me=e("label",{for:"username",class:"form-label"},"訂購人姓名:",-1),_e={class:"col-4"},he=e("label",{for:"email",class:"form-label"},"訂購人Email:",-1),pe={class:"col-4"},be=e("label",{for:"tel",class:"form-label"},"訂購人電話:",-1),fe={class:"col-6"},Oe=e("label",{for:"address",class:"form-label"},"訂購人地址:",-1),ge={class:"col-12"},ve=e("label",{for:"message",class:"form-label"},"留言備註",-1),we={class:"modal-footer"},ye=["disabled"];function Ve(n,s,b,f,t,c){const u=h("VField"),m=h("ErrorMessage"),O=h("VForm");return d(),a("div",R,[e("div",A,[e("div",q,[F,e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=o=>b.closeModal()),"aria-label":"Close"})]),e("div",$,[r(O,{id:"OrderModal",class:"row g-3",onSubmit:s[7]||(s[7]=o=>c.updateOrder(t.newOrder,t.newOrder.id))},{default:L(({errors:o})=>[H,e("div",N,[e("div",j,[G,e("input",{type:"text",class:"form-control","aria-label":"createdTime","aria-describedby":"create_at",disabled:"",value:n.timeTransform(t.newOrder.create_at)},null,8,J)])]),e("div",z,[e("div",X,[K,e("input",{type:"text",class:"form-control","aria-label":"ID","aria-describedby":"id",disabled:"",value:t.newOrder.id},null,8,Q)])]),e("div",W,[Y,w(e("input",{type:"checkbox",class:"btn-check",id:"btn-check-outlined",autocomplete:"off","onUpdate:modelValue":s[1]||(s[1]=l=>t.newOrder.is_paid=l)},null,512),[[I,t.newOrder.is_paid]]),e("label",{class:p(["btn",{"btn-outline-success":t.newOrder.is_paid,"btn-outline-danger":!t.newOrder.is_paid}]),for:"btn-check-outlined"},[t.newOrder.is_paid?(d(),a("span",Z,"已付款 ")):(d(),a("span",ee,"尚未付款 "))],2)]),te,e("div",se,[e("table",oe,[le,t.newOrder.products?(d(),a("tbody",ne,[(d(!0),a(g,null,k(t.newOrder.products,(l,v)=>(d(),a("tr",{key:v},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:qe=>c.deleteOrderItem(v)}," X ",8,re)]),e("td",null,i(l.product.title),1),e("td",null,i(l.qty),1),e("td",de,i(l.product.price),1),e("td",ae,i(l.final_total),1)]))),128))])):C("",!0)]),e("p",ie,"總金額:$ "+i(t.newOrder.total),1)]),ce,e("div",ue,[me,r(u,{id:"username",name:"訂購人姓名",type:"text",class:p(["form-control",{"is-invalid":o.訂購人姓名}]),placeholder:"請輸入 訂購人姓名",rules:"required",modelValue:t.newOrder.user.name,"onUpdate:modelValue":s[2]||(s[2]=l=>t.newOrder.user.name=l)},null,8,["class","modelValue"]),r(m,{name:"訂購人姓名",class:"invalid-feedback"})]),e("div",_e,[he,r(u,{id:"email",name:"訂購人Email",type:"email",class:p(["form-control",{"is-invalid":o.訂購人Email}]),placeholder:"請輸入 訂購人Email",rules:"required",modelValue:t.newOrder.user.email,"onUpdate:modelValue":s[3]||(s[3]=l=>t.newOrder.user.email=l)},null,8,["class","modelValue"]),r(m,{name:"訂購人Email",class:"invalid-feedback"})]),e("div",pe,[be,r(u,{id:"tel",name:"訂購人電話",type:"tel",class:p(["form-control",{"is-invalid":o.訂購人電話}]),placeholder:"請輸入 訂購人電話",rules:"required",modelValue:t.newOrder.user.tel,"onUpdate:modelValue":s[4]||(s[4]=l=>t.newOrder.user.tel=l)},null,8,["class","modelValue"]),r(m,{name:"訂購人電話",class:"invalid-feedback"})]),e("div",fe,[Oe,r(u,{id:"address",name:"訂購人地址",type:"address",class:p(["form-control",{"is-invalid":o.訂購人地址}]),placeholder:"請輸入 訂購人地址",rules:"required",modelValue:t.newOrder.user.address,"onUpdate:modelValue":s[5]||(s[5]=l=>t.newOrder.user.address=l)},null,8,["class","modelValue"]),r(m,{name:"訂購人Email",class:"invalid-feedback"})]),e("div",ge,[ve,w(e("textarea",{name:"",id:"message",cols:"20",rows:"5","onUpdate:modelValue":s[6]||(s[6]=l=>t.newOrder.user.message=l),class:"form-control"},null,512),[[S,t.newOrder.user.message]])])]),_:1})]),e("div",we,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[8]||(s[8]=o=>b.closeModal())}," 取消 "),e("button",{type:"submit",class:"btn btn-primary",disabled:t.loadingItem===t.newOrder.id,form:"OrderModal"}," 確認 ",8,ye)])])])}const Me=x(P,[["render",Ve]]),{VITE_URL:y,VITE_PATH:V}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"payroom",BASE_URL:"/boardGameSellStation/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},xe={data(){return{orders:[],tempOrder:{},page:{},isLoading:!1,orderModal:{}}},components:{PaginationComponent:T,OrderModal:Me},methods:{getOrders(n=1){this.isLoading=!0,this.$http.get(`${y}/v2/api/${V}/admin/orders?page=${n}`).then(s=>{this.orders=s.data.orders,this.page=s.data.pagination}).catch(s=>{_.fire({title:"錯誤發生",icon:"error",text:`${s.response.data.message}，請嘗試重新整理，如果此狀況持續發生，請聯絡我們`})}).finally(()=>{this.isLoading=!1})},openModal(n){this.tempOrder={...n},this.orderModal.show()},closeModal(){this.tempOrder={user:{},products:{}},this.orderModal.hide()},deleteOrder(n){_.fire({title:`確定刪除 ${n.id} 嗎?`,text:"刪除後不可復原，確定嗎",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonColor:"#d33",cancelButtonText:"取消"}).then(s=>{s.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${y}/v2/api/${V}/admin/order/${n.id}`).then(()=>{this.isLoading=!1,_.fire({icon:"success",title:"訂單刪除成功",showConfirmButton:!1,timer:1e3,didClose:()=>{this.getOrders()}})}))})},...M(E,["timeTransform"])},mounted(){this.getOrders(),this.orderModal=new U("#orderModal")}},ke={class:"vl-parent"},Ce={class:"row justify-content-center"},Ee={class:"col"},Te=e("h2",{class:"h2 text-center"},"訂單",-1),Le={class:"table table-hover"},Ie=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"建立時間"),e("th",{scope:"col"},"ID"),e("th",{scope:"col"},"姓名"),e("th",{scope:"col"},"付款狀態"),e("th",{scope:"col"},"總金額"),e("th",{scope:"col"},"編輯")])],-1),Se={key:0,class:"text-success"},Ue={key:1,class:"text-danger"},Be=["onClick"],De=["onClick"],Pe={colspan:"6",class:"text-center"},Re={class:"modal fade",id:"orderModal","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"};function Ae(n,s,b,f,t,c){const u=h("VLoading"),m=h("PaginationComponent"),O=h("OrderModal");return d(),a(g,null,[e("div",ke,[r(u,{active:t.isLoading,"onUpdate:active":s[0]||(s[0]=o=>t.isLoading=o)},null,8,["active"])]),e("div",Ce,[e("div",Ee,[Te,e("table",Le,[Ie,e("tbody",null,[t.orders?(d(!0),a(g,{key:0},k(t.orders,o=>(d(),a("tr",{key:o.id},[e("td",null,i(n.timeTransform(o.create_at*1e3)),1),e("td",null,i(o.id),1),e("td",null,i(o.user.name),1),e("td",null,[o.is_paid?(d(),a("span",Se,"已付款")):(d(),a("span",Ue,"未付款"))]),e("td",null,i(o.total),1),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm me-2",onClick:l=>c.openModal(o)}," 編輯 ",8,Be),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.deleteOrder(o)}," 刪除 ",8,De)])]))),128)):C("",!0)]),e("tfoot",null,[e("tr",null,[e("td",Pe," 本頁有"+i(t.orders.length)+"項訂單 ",1)])])]),r(m,{pages:t.page,"get-Method":c.getOrders},null,8,["pages","get-Method"])])]),e("div",Re,[r(O,{"temp-Order":t.tempOrder,"close-Modal":c.closeModal,"get-Orders":c.getOrders},null,8,["temp-Order","close-Modal","get-Orders"])])],64)}const Ne=x(xe,[["render",Ae]]);export{Ne as default};
